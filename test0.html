<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Analysis of the Iraq War</title>
<link rel="stylesheet" href="d3.slider.css" />
<!-- <link href="css/bootstrap.min.css" rel="stylesheet" media="screen"> -->
</head>

<style>
body {
    font-family: arial,sans-serif;
}
.boundary {
    fill: #fee8c8;
    stroke: #A8A8A8;
    stroke-width: 1px;
}
.tooltip {
    position: absolute;
    width: 150px;
    height: 60px;
    font: 15px rockwell;        
    background: lightgrey;   
    pointer-events: none;
}
.left {
    width: 55%;
    height = auto;
    margin-top: 10px; 
    margin-left: 5px;
    margin-right: 10px;
    float: left;
}
.right {
    width: 40%;
    height = auto;
    margin-top: 10px; 
    margin-left: 10px;
    margin-right: 5px;
    float: right;
/*     overflow:hidden; */
}
.right > div {
    margin: -20px 0;
}

</style>


<body>

<!-- The left side of the page that contains the map -->
<div class="left" id="left">
<h2>ay koonde </h2>   
</div> 

<!-- The right side of the page that contains the slider and graphs -->
<div class="right" id="right">
<h3><center>(year, month, day): <span id="slidertext"></span></center> </h3>
<br><div id="slider1"></div>
</div> 

</body>

<script src="d3.v3.min.js"></script>
<script src="topojson.v1.min.js"></script>
<script src="jquery.js"></script>
<script src="d3.slider.js"></script>


<script>
// reload page on resizes
window.onresize = function(){ location.reload(); }

var mydata = null;
var temp = d3.csv("aggIrq.csv", function(d) {return {key: d.key, value: +d.value};});
temp.get(function(e,r) {mydata = r;})
var num = 0;

var margin = {top: 80, right: 5, bottom: 10, left: 5};
var width = document.getElementById("left").offsetWidth;
var height = window.innerHeight;

var projection = d3.geo.mercator()
    .center([37, 37.4])
    .scale(4.2*width)
    .translate([0, 0])
    .precision(.1);

var path = d3.geo.path()
    .projection(projection);
 
var svg = d3.select("#left").append("svg")
    .attr("width", width)
    .attr("height", height)
    .append("g")
    .attr("transform", "translate(" + margin.left + "," + margin.top-20 + ")");    
    
var tooltip = d3.select("#left").append("div")
    .attr("class", "tooltip")
    .style("opacity", 10);
    

//SLIDER
d3.select('#slidertext').text(2004);
d3.select('#slider1').call(d3.slider().axis(true).min(2004).max(2010).step((2010-2004)/2200)
.on("slide", function(evt, value) {
    d3.select('#slidertext')
    .text(value); }));

//LOAD MAP OF IRAQ WITH DISTRICTS
d3.json("districts-geo.json", function(error, irq) {
  svg.selectAll(".districts")
      .data(topojson.feature(irq, irq.objects.districts).features)
      .enter().append("path")
      .attr("class", function(d) { return "district " + d.id; })
      .attr("d", path)
      .attr("class", "boundary")
      .on("mouseover", function(d) {
          tooltip.transition()
               .duration(200)
               .style("opacity", .8);
          tooltip.html(d["id"])
               .style("left", (d3.event.pageX + width*0.007) + "px")
               .style("top", (d3.event.pageY - height*0.056) + "px"); })
      .on("mouseout", function(d) {
          tooltip.transition()
               .duration(1000)
               .style("opacity", 0); });

//MARK SOME CITIES
d3.csv("cities.csv", function(error, cities) {
    cities.forEach(function(d) {
    d.lat = +d.lat;
    d.lon = +d.lon; });
var elemEnter = svg.selectAll(".g")
    .data(cities)
    .enter().append("g")
    .attr("transform", function(d){return "translate(" + projection([d.lon, d.lat]) + ")"});
var circle = elemEnter.append("circle")
    .attr("r", width*0.004 )
    .attr("stroke","black")
    .attr("fill", "black");
elemEnter.append("text")
    .attr("font-size", width*0.022+'px')
    .attr("dx", width*0.007) 
    .attr("y", function(d){ if (d.city=='Ramadi') {return -0.014*width} if (d.city=='Mosul') {return -0.014*width} if (d.city=='Fallujah') {return 0.028*width} else {return 0.014*width} }) 
    .attr("x", function(d){ if (d.city=='Ramadi') {return -0.07*width} if (d.city=='Fallujah') {return -0.06*width} else {return 0} }) 
    .text(function(d){return d.city}); 
}); 
});

//DRAW COLORBAR 
numbers = d3.range(0,20,0.5);  //later, this will be my data 
data_cm = d3.range(0,d3.max(numbers),d3.max(numbers)/20);
colorScale = d3.scale.linear()
    .domain([d3.min(data_cm),d3.max(data_cm)]) 
    .range(["#fee8c8","#b60f2e"]);
local_height = height-20;
nb_rect = data_cm.length+1;
rect_height = local_height/nb_rect;
var rects = svg.selectAll(".rect")
    .data(data_cm)
    .enter().append("rect")
    .attr({
        width: width*0.03,
        height: rect_height,
        y: function(d,i) {return -i*rect_height+1*local_height-rect_height;},
        x: 0.07*width,
        fill: function(d,i) {return colorScale(d);}
    });
svg.selectAll(".texts")
    .data(data_cm)
    .enter().append("text")
    .attr("class","texts")
    .attr("dy", ".2em")
    .attr("x", width*0.04)
    .attr("font-size", width*0.02+'px')
    .attr("font", 'Rockwell')
    .attr("y", function(d,i) {return -i*rect_height+1*local_height-rect_height/2;})
    .attr("text-anchor","middle")
    .style("fill", "#5d5d5d")
    .style("opacity", function(d,i) {return (d*10 % 2) ? 0 : 1;})
    .text(function(d) {return ''+(d);}); 
   

  
</script>
